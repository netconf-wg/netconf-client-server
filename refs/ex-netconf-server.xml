<netconf-server
  xmlns="urn:ietf:params:xml:ns:yang:ietf-netconf-server"
  xmlns:ct="urn:ietf:params:xml:ns:yang:ietf-crypto-types"
  xmlns:x509c2n="urn:ietf:params:xml:ns:yang:ietf-x509-cert-to-name">

  <!-- endpoints to listen for NETCONF connections on -->
  <listen>
    <endpoint> <!-- listening for SSH connections -->
      <name>netconf/ssh</name>
      <ssh>
        <tcp-server-parameters>
          <local-address>192.0.2.7</local-address>
        </tcp-server-parameters>
        <ssh-server-parameters>
          <server-identity>
            <host-key>
              <name>deployment-specific-certificate</name>
              <public-key>
                <keystore-reference>ssh-rsa-key</keystore-reference>
              </public-key>
            </host-key>
          </server-identity>
          <client-authentication>
            <supported-authentication-methods>
              <publickey/>
            </supported-authentication-methods>
          </client-authentication>
        </ssh-server-parameters>
        <netconf-server-parameters>
          <!-- nothing to configure -->
        </netconf-server-parameters>
      </ssh>
    </endpoint>
    <endpoint> <!-- listening for TLS sessions -->
      <name>netconf/tls</name>
      <tls>
        <tcp-server-parameters>
          <local-address>192.0.2.7</local-address>
        </tcp-server-parameters>
        <tls-server-parameters>
          <server-identity>
            <certificate>
              <keystore-reference>
                <asymmetric-key>rsa-asymmetric-key</asymmetric-key>
                <certificate>ex-rsa-cert</certificate>
              </keystore-reference>
            </certificate>
          </server-identity>
          <client-authentication>
            <ca-certs>
              <truststore-reference>trusted-client-ca-certs</truststore-reference>
            </ca-certs>
            <ee-certs>
              <truststore-reference>trusted-client-ee-certs</truststore-reference>
            </ee-certs>
          </client-authentication>
          <keepalives>
            <peer-allowed-to-send/>
          </keepalives>
        </tls-server-parameters>
        <netconf-server-parameters>
          <client-identity-mappings>
            <cert-to-name>
              <id>1</id>
              <fingerprint>11:0A:05:11:00</fingerprint>
              <map-type>x509c2n:specified</map-type>
              <name>scooby-doo</name>
            </cert-to-name>
            <cert-to-name>
              <id>2</id>
              <map-type>x509c2n:san-any</map-type>
            </cert-to-name>
          </client-identity-mappings>
        </netconf-server-parameters>
      </tls>
    </endpoint>
  </listen>

  <!-- calling home to SSH and TLS based NETCONF clients -->
  <call-home>
    <netconf-client> <!-- SSH-based client -->
      <name>config-mgr</name>
      <endpoints>
        <endpoint>
          <name>east-data-center</name>
          <ssh>
            <tcp-client-parameters>
              <remote-address>east.config-mgr.example.com</remote-address>
              <keepalives>
                <idle-time>15</idle-time>
                <max-probes>3</max-probes>
                <probe-interval>30</probe-interval>
              </keepalives>
            </tcp-client-parameters>
            <ssh-server-parameters>
              <server-identity>
                <host-key>
                  <name>deployment-specific-certificate</name>
                  <public-key>
                    <keystore-reference>ssh-rsa-key</keystore-reference>
                  </public-key>
                </host-key>
              </server-identity>
              <client-authentication>
                <supported-authentication-methods>
                  <publickey/>
                </supported-authentication-methods>
              </client-authentication>
            </ssh-server-parameters>
            <netconf-server-parameters>
              <!-- nothing to configure -->
            </netconf-server-parameters>
          </ssh>
        </endpoint>
        <endpoint>
          <name>west-data-center</name>
          <ssh>
            <tcp-client-parameters>
              <remote-address>west.config-mgr.example.com</remote-address>
            </tcp-client-parameters>
            <ssh-server-parameters>
              <server-identity>
                <host-key>
                  <name>deployment-specific-certificate</name>
                  <public-key>
                    <keystore-reference>ssh-rsa-key</keystore-reference>
                  </public-key>
                </host-key>
              </server-identity>
              <client-authentication>
                <supported-authentication-methods>
                  <publickey/>
                </supported-authentication-methods>
              </client-authentication>
            </ssh-server-parameters>
            <netconf-server-parameters>
              <!-- nothing to configure -->
            </netconf-server-parameters>
          </ssh>
        </endpoint>
      </endpoints>
      <connection-type>
        <periodic>
          <idle-timeout>300</idle-timeout>
          <period>60</period>
        </periodic>
      </connection-type>
      <reconnect-strategy>
        <start-with>last-connected</start-with>
        <max-attempts>3</max-attempts>
      </reconnect-strategy>
    </netconf-client>
    <netconf-client> <!-- TLS-based client -->
      <name>data-collector</name>
      <endpoints>
        <endpoint>
          <name>east-data-center</name>
          <tls>
            <tcp-client-parameters>
              <remote-address>east.analytics.example.com</remote-address>
              <keepalives>
                <idle-time>15</idle-time>
                <max-probes>3</max-probes>
                <probe-interval>30</probe-interval>
              </keepalives>
            </tcp-client-parameters>
            <tls-server-parameters>
              <server-identity>
                <certificate>
                  <keystore-reference>
                    <asymmetric-key>rsa-asymmetric-key</asymmetric-key>
                    <certificate>ex-rsa-cert</certificate>
                  </keystore-reference>
                </certificate>
              </server-identity>
              <client-authentication>
                <ca-certs>
                  <truststore-reference>trusted-client-ca-certs</truststore-reference>
                </ca-certs>
                <ee-certs>
                  <truststore-reference>trusted-client-ee-certs</truststore-reference>
                </ee-certs>
              </client-authentication>
              <keepalives>
                <test-peer-aliveness>
                  <max-wait>30</max-wait>
                  <max-attempts>3</max-attempts>
                </test-peer-aliveness>
              </keepalives>
            </tls-server-parameters>
            <netconf-server-parameters>
              <client-identity-mappings>
                <cert-to-name>
                  <id>1</id>
                  <fingerprint>11:0A:05:11:00</fingerprint>
                  <map-type>x509c2n:specified</map-type>
                  <name>scooby-doo</name>
                </cert-to-name>
                <cert-to-name>
                  <id>2</id>
                  <map-type>x509c2n:san-any</map-type>
                </cert-to-name>
              </client-identity-mappings>
            </netconf-server-parameters>
          </tls>
        </endpoint>
        <endpoint>
          <name>west-data-center</name>
          <tls>
            <tcp-client-parameters>
              <remote-address>west.analytics.example.com</remote-address>
              <keepalives>
                <idle-time>15</idle-time>
                <max-probes>3</max-probes>
                <probe-interval>30</probe-interval>
              </keepalives>
            </tcp-client-parameters>
            <tls-server-parameters>
              <server-identity>
                <certificate>
                  <keystore-reference>
                    <asymmetric-key>rsa-asymmetric-key</asymmetric-key>
                    <certificate>ex-rsa-cert</certificate>
                  </keystore-reference>
                </certificate>
              </server-identity>
              <client-authentication>
                <ca-certs>
                  <truststore-reference>trusted-client-ca-certs</truststore-reference>
                </ca-certs>
                <ee-certs>
                  <truststore-reference>trusted-client-ee-certs</truststore-reference>
                </ee-certs>
              </client-authentication>
              <keepalives>
                <test-peer-aliveness>
                  <max-wait>30</max-wait>
                  <max-attempts>3</max-attempts>
                </test-peer-aliveness>
              </keepalives>
            </tls-server-parameters>
            <netconf-server-parameters>
              <client-identity-mappings>
                <cert-to-name>
                  <id>1</id>
                  <fingerprint>11:0A:05:11:00</fingerprint>
                  <map-type>x509c2n:specified</map-type>
                  <name>scooby-doo</name>
                </cert-to-name>
                <cert-to-name>
                  <id>2</id>
                  <map-type>x509c2n:san-any</map-type>
                </cert-to-name>
              </client-identity-mappings>
            </netconf-server-parameters>
          </tls>
        </endpoint>
      </endpoints>
      <connection-type>
        <persistent/>
      </connection-type>
      <reconnect-strategy>
        <start-with>first-listed</start-with>
        <max-attempts>3</max-attempts>
      </reconnect-strategy>
    </netconf-client>
  </call-home>
</netconf-server>
